import{r as e,a as r,R as t}from"./vendor-CqEpiFl-.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))r(e);new MutationObserver((e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&r(e)})).observe(document,{childList:!0,subtree:!0})}function r(e){if(e.ep)return;e.ep=!0;const r=function(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerPolicy&&(r.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?r.credentials="include":"anonymous"===e.crossOrigin?r.credentials="omit":r.credentials="same-origin",r}(e);fetch(e.href,r)}}();var s={exports:{}},n={},o=e,a=Symbol.for("react.element"),i=Symbol.for("react.fragment"),c=Object.prototype.hasOwnProperty,l=o.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};function u(e,r,t){var s,n={},o=null,i=null;for(s in void 0!==t&&(o=""+t),void 0!==r.key&&(o=""+r.key),void 0!==r.ref&&(i=r.ref),r)c.call(r,s)&&!d.hasOwnProperty(s)&&(n[s]=r[s]);if(e&&e.defaultProps)for(s in r=e.defaultProps)void 0===n[s]&&(n[s]=r[s]);return{$$typeof:a,type:e,key:o,ref:i,props:n,_owner:l.current}}n.Fragment=i,n.jsx=u,n.jsxs=u,s.exports=n;var m,h=s.exports,x=r;m=x.createRoot,x.hydrateRoot;const p="https://wintermute-staging-x-49dd432d3500.herokuapp.com",f=(p.endsWith("/")?p:p+"/")+"api/v1/",w=(e,r,t)=>{const s=crypto.randomUUID();return{matches:[],similarity_scores:[],error:{code:e,message:r,trace_id:s,timestamp:(new Date).toISOString(),details:t},trace_id:s}},y=()=>{const[r,t]=e.useState(""),[s,n]=e.useState([]),[o,a]=e.useState(!1),[i,c]=e.useState(""),[l,d]=e.useState(!1),[u,m]=e.useState(!1),[x,p]=e.useState(!1),[y,g]=e.useState(null),b=e.useRef(null),j=e.useRef(null),v=e.useRef([]),N=e.useRef(null),k=e.useRef(null);e.useEffect((()=>{if(c(crypto.randomUUID()),!N.current){const e=new Audio;e.addEventListener("ended",(()=>p(!1))),N.current=e}return()=>{N.current&&(N.current.pause(),N.current.removeEventListener("ended",(()=>p(!1)))),k.current&&clearInterval(k.current)}}),[]),e.useEffect((()=>{b.current&&b.current.scrollIntoView({behavior:"smooth"})}),[s]),e.useEffect((()=>{s.length>10&&n((e=>e.slice(-10)))}),[s]);const _=async()=>{try{const e=new Blob(v.current,{type:"audio/webm"}),r=await(async e=>{try{const r=new FormData;r.append("audio_file",e,"recording.webm");const t=await fetch(`${f}voice/speech-to-text/`,{method:"POST",body:r});if(!t.ok){const e=await t.text();return{transcribed_text:"",error:`API Error: ${t.status} - ${e}`}}const s=await t.json();return{transcribed_text:s.text||"",error:s.error}}catch(r){return{transcribed_text:"",error:r instanceof Error?r.message:"Unknown error"}}})(e);if(r.error)throw new Error(r.error);const o=r.transcribed_text;if(!o.trim())throw new Error("Could not understand speech. Please try again.");t(o);const a=crypto.randomUUID(),c=s.length;n((e=>[...e,{query:o,response:"Thinking...",error:null,timestamp:(new Date).toISOString(),isProcessing:!0}]));const l=await(async(e,r,t)=>{try{const s=await fetch(`${f}voice/process-input/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e,window_id:r,session_id:t||crypto.randomUUID(),enable_webhook:!0})});if(!s.ok){const e=await s.text();throw new Error(`API Error: ${s.status} - ${e}`)}return await s.json()}catch(s){throw s}})(o,i,a);if(!l||l.error)throw new Error((null==l?void 0:l.error)||"Processing failed");l.audio_url&&N.current&&(N.current.src=l.audio_url,N.current.play(),p(!0)),k.current&&clearInterval(k.current),k.current=setInterval((async()=>{try{const e=await(async e=>{try{const r=await fetch(`${f}voice/check-status/${e}`);if(!r.ok){const e=await r.text();throw new Error(`API Error: ${r.status} - ${e}`)}return await r.json()}catch(r){throw r}})(a);"completed"===e.status&&e.audio_url&&(k.current&&(clearInterval(k.current),k.current=null),n((r=>r.map(((r,t)=>t===c?{...r,response:e.response||r.response,audioUrl:e.audio_url,isProcessing:!1}:r)))),e.audio_url&&N.current&&!x&&(N.current.src=e.audio_url,N.current.play(),p(!0)))}catch(e){}}),2e3),setTimeout((()=>{k.current&&(clearInterval(k.current),k.current=null,n((e=>e.map(((e,r)=>r===c&&e.isProcessing?{...e,response:"Sorry, it's taking longer than expected. Please try again.",isProcessing:!1}:e)))))}),3e4)}catch(e){g(`Error: ${e instanceof Error?e.message:"Unknown error"}`),n((e=>e.length>0&&"Thinking..."===e[e.length-1].response?e.slice(0,-1):e))}finally{a(!1)}};return h.jsxs("div",{className:"flex flex-col items-center justify-start w-full h-full p-8 space-y-6",children:[h.jsx("div",{className:"w-full max-w-md flex justify-end mb-2",children:h.jsxs("label",{className:"inline-flex items-center cursor-pointer",children:[h.jsx("span",{className:"mr-3 text-sm font-medium text-gray-400",children:"Voice Mode"}),h.jsxs("div",{className:"relative",children:[h.jsx("input",{type:"checkbox",className:"sr-only peer",checked:l,onChange:()=>d(!l)}),h.jsx("div",{className:"w-11 h-6 bg-gray-700 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]})}),h.jsxs("div",{className:"w-full max-w-md flex-grow overflow-y-auto mb-4 max-h-[60vh] border border-gray-700 rounded-lg p-4 bg-gray-900",children:[0===s.length?h.jsx("p",{className:"text-gray-500 text-center italic",children:"No interactions yet. Start by sending a query below."}):s.map(((e,r)=>h.jsxs("div",{className:"mb-6 last:mb-2",children:[h.jsxs("div",{className:"mb-2",children:[h.jsx("div",{className:"font-bold text-blue-400 mb-1",children:"You:"}),h.jsx("div",{className:"pl-3 border-l-2 border-blue-400 text-gray-300",children:e.query})]}),e.error?h.jsxs("div",{className:"mt-2",children:[h.jsx("div",{className:"font-bold text-red-500 mb-1",children:"Error:"}),h.jsxs("div",{className:"p-3 bg-red-900 border border-red-500 rounded-lg",children:[h.jsx("p",{className:"font-bold",children:e.error.code}),h.jsx("p",{children:e.error.message}),e.error.details&&h.jsx("pre",{className:"mt-2 text-sm overflow-x-auto",children:JSON.stringify(e.error.details,null,2)})]})]}):h.jsxs("div",{className:"mt-2",children:[h.jsxs("div",{className:"font-bold text-green-400 mb-1 flex items-center justify-between",children:[h.jsx("span",{children:"Wintermute:"}),l&&e.audioUrl&&h.jsxs("button",{onClick:()=>{return r=e.audioUrl,void(N.current&&r&&(x&&N.current.pause(),N.current.src=r,N.current.play(),p(!0)));var r},className:"text-sm bg-blue-600 hover:bg-blue-700 text-white py-1 px-2 rounded flex items-center",children:[h.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[h.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),h.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]}),"Play"]})]}),h.jsxs("div",{className:"pl-3 border-l-2 border-green-400 text-gray-300 whitespace-pre-wrap "+(e.isProcessing?"italic text-gray-500":""),children:[e.response,e.isProcessing&&h.jsxs("span",{className:"inline-flex ml-2",children:[h.jsx("span",{className:"animate-bounce mx-px",children:"."}),h.jsx("span",{className:"animate-bounce animation-delay-200 mx-px",children:"."}),h.jsx("span",{className:"animate-bounce animation-delay-400 mx-px",children:"."})]})]})]})]},r))),h.jsx("div",{ref:b})]}),y&&h.jsx("div",{className:"w-full max-w-md p-3 bg-red-900 border border-red-500 rounded text-white mb-4",children:y}),h.jsxs("div",{className:"w-full max-w-md flex flex-col space-y-4",children:[h.jsx("textarea",{value:r,onChange:e=>t(e.target.value),className:"w-full p-4 border rounded-lg text-gray-300 bg-gray-800 focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your query here...",rows:4,disabled:u||o}),h.jsxs("div",{className:"flex items-center space-x-2",children:[h.jsx("button",{onClick:async()=>{if(!r.trim())return;a(!0);const e=r;t("");try{const r=await(async(e,r)=>{try{const s={prompt:e,top_k:5,window_id:r,request_metadata:{operation_type:"QUERY",timestamp:(new Date).toISOString(),window_id:r,trace_id:crypto.randomUUID()}},n=await fetch(`${f}query`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(s)});if(!n.ok){let e,r=`HTTP Error ${n.status}: ${n.statusText}`;try{e=await n.json(),e.message&&(r=e.message)}catch(t){const s=await n.text();e={raw:s},s&&(r+=` - ${s}`)}return w(`API_ERROR_${n.status}`,r,e)}return await n.json()}catch(s){return w("CLIENT_ERROR",s instanceof Error?s.message:"Unknown client error",{error:s})}})(e,i),t={query:e,response:r.error?null:r.response||"No response from the AI.",error:r.error||null,timestamp:(new Date).toISOString()};if(l&&!r.error&&r.response)try{const e=await(async e=>{try{const r=new FormData;r.append("text",e);const t=await fetch(`${f}voice/text-to-speech/`,{method:"POST",body:r});if(!t.ok){const r=await t.text();return{audio_url:"",response:e,error:`API Error: ${t.status} - ${r}`}}const s=await t.json();return{audio_url:s.audio_url||"",response:e,error:s.error}}catch(r){return{audio_url:"",response:e,error:r instanceof Error?r.message:"Unknown error"}}})(r.response);e.audio_url&&(t.audioUrl=e.audio_url,N.current&&(N.current.src=e.audio_url,N.current.play(),p(!0)))}catch(s){}n((e=>[...e,t]))}catch(s){const r={query:e,response:null,error:{code:"UNKNOWN_ERROR",message:s instanceof Error?s.message:"An unknown error occurred",timestamp:(new Date).toISOString()},timestamp:(new Date).toISOString()};n((e=>[...e,r]))}finally{a(!1)}},disabled:o||u||!r.trim(),className:"flex-1 px-6 py-2 bg-blue-500 text-white rounded-lg disabled:opacity-50 disabled:cursor-not-allowed",children:o?"Processing...":"Send Query"}),l&&h.jsx("button",{onClick:u?()=>{j.current&&u&&(j.current.stop(),m(!1),a(!0))}:async()=>{g(null);try{const e=await navigator.mediaDevices.getUserMedia({audio:!0}),r=new MediaRecorder(e);j.current=r,v.current=[],r.ondataavailable=e=>{e.data.size>0&&v.current.push(e.data)},r.onstop=_,r.start(),m(!0)}catch(e){g("Could not access microphone. Please check permissions.")}},disabled:o&&!u,className:`w-12 h-12 rounded-full flex items-center justify-center transition duration-300 ${u?"bg-red-600 hover:bg-red-700":"bg-blue-600 hover:bg-blue-700"} ${o&&!u?"opacity-50 cursor-not-allowed":""}`,children:o&&!u?h.jsxs("svg",{className:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[h.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),h.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):u?h.jsx("svg",{className:"h-5 w-5 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:h.jsx("rect",{x:"6",y:"6",width:"12",height:"12",strokeWidth:"2"})}):h.jsx("svg",{className:"h-5 w-5 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:h.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"})})})]}),l&&h.jsx("div",{className:"text-center text-gray-400 text-sm",children:u?"Click the button when you're done speaking":o?"Processing your question...":"Click the microphone button to speak your question"})]})]})},g=()=>h.jsxs("div",{className:"flex flex-col items-center justify-center w-full h-screen",children:[h.jsx("h1",{className:"text-4xl font-bold mb-2",children:"wintermute ai system"})," ",h.jsx("p",{className:"text-sm text-gray-500 mb-8",children:"By jay"})," ",h.jsx("div",{className:"w-64 h-4 bg-gray-700 rounded-full overflow-hidden",children:h.jsx("div",{className:"h-full bg-blue-500 transition-all duration-500 ease-in-out",style:{width:"100%"}})})]}),b=()=>{const[r,t]=e.useState(!0),[s]=e.useState(`wintermute-${Date.now()}`);return e.useEffect((()=>{const e=setTimeout((()=>{t(!1)}),2e3);return()=>{clearTimeout(e)}}),[s]),h.jsx("div",{className:"min-h-screen bg-gray-900 flex flex-col",children:r?h.jsx(g,{}):h.jsxs(h.Fragment,{children:[h.jsx("header",{className:"bg-gray-800 p-4 shadow-md",children:h.jsx("div",{className:"container mx-auto"})}),h.jsx("main",{className:"container mx-auto py-6 flex-1 flex flex-col",children:h.jsx(y,{},`integrated-${s}`)}),h.jsx("footer",{className:"bg-gray-800 p-4",children:h.jsx("div",{className:"container mx-auto text-center text-gray-400 text-sm"})})]})})},j=document.getElementById("root");if(!j)throw new Error("Root element not found");m(j).render(h.jsx(t.StrictMode,{children:h.jsx(b,{})}));
